(function(n,r){typeof exports=="object"&&typeof module<"u"?r(exports):typeof define=="function"&&define.amd?define(["exports"],r):(n=typeof globalThis<"u"?globalThis:n||self,r(n.PivotheadCore={}))})(this,function(n){"use strict";function r(u,t){return[...u].sort((e,s)=>{const i=e[t.field],o=s[t.field];return i<o?t.direction==="asc"?-1:1:i>o?t.direction==="asc"?1:-1:0})}function h(u,t=null,e=null){let s=[...u.data];if(t&&(s=r(s,t)),e){const{fields:i,grouper:o}=e,a={};s.forEach(l=>{const p=o(l,i);a[p]||(a[p]=[]),a[p].push(l)}),s=Object.values(a).flat()}return s}class d{constructor(t){this.config=t,this.state={data:h(t),sortConfig:null,rowSizes:this.initializeRowSizes(t.data),expandedRows:{},groupConfig:t.groupConfig||null,groups:[]}}initializeRowSizes(t){return t.map((e,s)=>({index:s,height:40}))}sort(t,e){this.state.sortConfig={field:t,direction:e},this.applySort()}applySort(){this.state.data=h(this.config,this.state.sortConfig),this.state.rowSizes=this.state.data.map((t,e)=>this.state.rowSizes[e]||{index:e,height:40})}applyGrouping(){if(!this.state.groupConfig)return;const{fields:t,grouper:e}=this.state.groupConfig;this.state.groups=this.createGroups(this.state.data,t,e)}createGroups(t,e,s){if(e.length===0)return[{key:"All",items:t}];const i={};return t.forEach(o=>{const a=s(o,e);i[a]||(i[a]={key:a,items:[],subgroups:[]}),i[a].items.push(o)}),e.length>1&&Object.values(i).forEach(o=>{o.subgroups=this.createGroups(o.items,e.slice(1),s)}),Object.values(i)}setGroupConfig(t){this.state.groupConfig=t,t?this.applyGrouping():this.state.groups=[]}getGroupedData(){return this.state.groups}getState(){return{...this.state}}reset(){this.state.sortConfig=null,this.state.data=h(this.config),this.state.rowSizes=this.initializeRowSizes(this.config.data),this.state.expandedRows={}}resizeRow(t,e){const s=this.state.rowSizes.findIndex(i=>i.index===t);s!==-1&&(this.state.rowSizes[s].height=Math.max(20,e))}toggleRowExpansion(t){this.state.expandedRows[t]=!this.state.expandedRows[t]}isRowExpanded(t){return!!this.state.expandedRows[t]}}n.PivotEngine=d,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});
